# Tasks: Minervia Institute 教育平台初始设计

## Phase 0: 项目脚手架 (Foundation)
- [x] 初始化前端项目 (Next.js 14 + TypeScript + Tailwind + shadcn/ui)
- [x] 初始化后端项目 (Kotlin + Spring Boot 3.x + Gradle)
- [x] 配置 MySQL 数据库连接和基础表结构
- [x] 配置 Redis 缓存连接
- [x] 搭建 Docker Compose 开发环境
- [ ] 配置 CI/CD 基础流程 (lint/test/build)

## Phase 1: 核心实体和数据模型
- [x] 设计并实现学生(Student)实体和表结构
- [x] 设计并实现管理员(Admin)实体和表结构
- [x] 设计并实现注册申请(RegistrationApplication)实体和表结构
- [x] 设计并实现注册码(RegistrationCode)实体和表结构
- [x] 设计并实现审计日志(AuditLog)实体和表结构
- [x] 实现 JPA Repository 层
- [x] 编写 Flyway/Liquibase 数据库迁移脚本

## Phase 2: 认证和授权模块
- [x] 实现管理员登录 API (JWT)
- [x] 实现密码加密 (bcrypt cost=12)
- [x] 实现登录失败锁定 (5次/30分钟)
- [x] 实现 RBAC 权限控制 (超级管理员/普通管理员)
- [x] 实现 JWT Token 刷新机制
- [x] 实现管理员会话超时 (1小时无操作)
- [ ] 实现 TOTP 两步验证 (可选)

## Phase 3: 注册流程模块 (registration-flow)
### 3.1 注册码管理
- [x] 实现注册码生成 API
- [x] 实现注册码批量生成 API
- [x] 实现注册码验证 API
- [x] 实现注册码撤销 API
- [x] 实现注册码列表查询 API
- [x] 实现注册码过期检测

### 3.2 邮箱验证
- [x] 实现发送验证码 API
- [x] 实现验证码校验 API
- [x] 实现验证码过期处理
- [x] 实现验证码发送限流 (5次/小时)

### 3.3 注册申请
- [x] 实现提交注册申请 API
- [x] 实现注册状态机 (未开始->注册码验证->邮箱验证->信息选择->待批准->生成中->已完成)
- [x] 实现 IP 限流 (3次/小时)
- [x] 实现邮箱限流 (1次/24小时)

### 3.4 Linux.do OAuth
- [ ] 实现 Linux.do OAuth 回调处理
- [ ] 实现 OAuth 用户关联逻辑

## Phase 4: 身份信息生成模块 (identity-generation)
### 4.1 规则引擎
- [x] 实现姓名生成器 (按国家/文化)
- [x] 实现出生日期生成器 (年龄约束)
- [x] 实现学号生成器 (格式: 年份+学院代码+序号)
- [x] 实现时间线生成器 (录取日期/入学日期)

### 4.2 约束校验
- [x] 实现年龄与学籍一致性校验
- [x] 实现时间线一致性校验
- [x] 实现专业与学院一致性校验
- [x] 实现学号唯一性校验

### 4.3 LLM 润色
- [ ] 实现 LLM 调用服务 (家庭背景/兴趣爱好/学术目标)
- [ ] 实现 LLM 失败降级 (预设模板)

### 4.4 学习时间线生成
- [ ] 实现学期生成 (秋季/春季)
- [ ] 实现课程列表生成 (按专业)
- [ ] 实现成绩生成 (2.0-5.0 波兰评分)
- [ ] 实现 GPA 计算

### 4.5 家庭信息生成
- [ ] 实现父母姓名生成
- [ ] 实现父母职业生成
- [ ] 实现家庭地址生成

### 4.6 安全机制
- [x] 实现禁用姓名列表检查
- [x] 实现模拟数据标记 (is_simulated)
- [x] 实现生成种子和版本记录

### 4.7 批量和导出
- [ ] 实现批量生成 API
- [ ] 实现导出 JSON/CSV API

## Phase 5: 管理后台 API (admin-backend)
### 5.1 学生管理
- [ ] 实现学生列表查询 API (分页/搜索/筛选)
- [ ] 实现学生详情查询 API
- [ ] 实现手动创建学生 API
- [ ] 实现修改学生信息 API
- [ ] 实现封禁学生 API
- [ ] 实现解封学生 API

### 5.2 注册审批
- [ ] 实现待审批列表查询 API
- [ ] 实现审批详情查询 API
- [ ] 实现批准注册 API
- [ ] 实现拒绝注册 API
- [ ] 实现批量批准 API

### 5.3 系统配置
- [ ] 实现配置查询 API
- [ ] 实现配置修改 API (邮件配额/注册码有效期/JWT过期时间等)

### 5.4 数据可视化
- [ ] 实现学生统计 API
- [ ] 实现邮件统计 API
- [ ] 实现注册统计 API

## Phase 6: 审计日志模块 (audit-logging)
- [ ] 实现审计日志记录服务 (异步队列)
- [ ] 实现审计日志查询 API (时间/类型/操作人/对象)
- [ ] 实现审计日志导出 API (CSV/JSON)
- [ ] 实现审计日志完整性校验 (哈希)
- [ ] 实现审计日志保留策略 (5年)
- [ ] 实现 Elasticsearch 同步
- [ ] 实现告警机制 (批量封禁/异常登录/配置修改)

## Phase 7: 异步任务系统
- [ ] 配置 Kafka 消息队列
- [ ] 实现事务性 Outbox 模式（批准事务+outbox表+轮询发送）
- [ ] 实现身份生成异步任务（幂等处理，applicationId为去重键）
- [ ] 实现 Spring WebSocket/STOMP 实时进度推送
- [ ] 实现状态轮询降级端点 GET /api/applications/{id}/status
- [ ] 实现任务状态管理 (PENDING/GENERATING_IDENTITY/GENERATING_PHOTOS/COMPLETED/FAILED)
- [ ] 实现失败重试机制 (3次指数退避)

## Phase 8: 前端 - 管理后台
- [ ] 实现管理员登录页面
- [ ] 实现仪表盘页面
- [ ] 实现学生管理页面
- [ ] 实现注册审批页面
- [ ] 实现注册码管理页面
- [ ] 实现审计日志页面
- [ ] 实现系统配置页面

## Phase 9: 前端 - 注册流程
- [ ] 实现注册码验证步骤
- [ ] 实现邮箱验证步骤
- [ ] 实现信息选择步骤 (专业/班级/身份类型/国家)
- [ ] 实现注册进度追踪页面 (WebSocket)
- [ ] 实现 Linux.do OAuth 登录按钮

## Phase 10: 国际化和多语言
- [ ] 配置 next-intl
- [ ] 实现基于路由的国际化 (/en, /pl, /zh-CN 等)
- [ ] 翻译管理后台文案
- [ ] 翻译注册流程文案

## Phase 11: 测试和文档
- [ ] 编写后端单元测试 (JUnit 5)
- [ ] 编写后端集成测试
- [ ] 编写前端组件测试 (Vitest)
- [ ] 编写 API 文档 (OpenAPI/Swagger)
- [ ] 编写部署文档
