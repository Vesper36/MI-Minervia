# Specification: Admin Backend

## ADDED Requirements

### Requirement: 分级权限管理
系统必须实现基于角色的访问控制（RBAC），支持超级管理员和普通管理员两种角色。

#### Scenario: 超级管理员拥有所有权限
- **WHEN** 超级管理员登录系统
- **THEN** 系统授予所有功能的访问权限（学生管理、注册审批、邮件监控、系统配置等）

#### Scenario: 普通管理员权限受限
- **WHEN** 普通管理员登录系统
- **THEN** 系统仅授予学生管理和注册审批权限，不能访问系统配置和敏感数据

#### Scenario: 权限检查拦截未授权操作
- **WHEN** 普通管理员尝试访问系统配置页面
- **THEN** 系统显示错误消息"权限不足"，阻止访问

#### Scenario: 超级管理员可以创建和管理管理员账户
- **WHEN** 超级管理员创建新的管理员账户
- **THEN** 系统允许设置角色（超级管理员或普通管理员）

### Requirement: 学生账户管理
系统必须允许管理员查看、创建、修改和封禁学生账户。

#### Scenario: 查看所有学生账户列表
- **WHEN** 管理员访问学生管理页面
- **THEN** 系统显示所有学生账户列表，包括学号、姓名、专业、状态等信息

#### Scenario: 搜索和筛选学生账户
- **WHEN** 管理员输入搜索关键词或选择筛选条件
- **THEN** 系统显示匹配的学生账户列表

#### Scenario: 查看学生详细信息
- **WHEN** 管理员点击某个学生账户
- **THEN** 系统显示该学生的完整信息（身份信息、邮箱、证明文件、邮件记录等）

#### Scenario: 手动创建学生账户
- **WHEN** 管理员填写学生信息并提交
- **THEN** 系统创建学生账户，跳过注册流程，直接生成身份信息和 EDU 邮箱

#### Scenario: 修改学生账户信息
- **WHEN** 管理员修改学生的专业或班级
- **THEN** 系统更新学生信息，记录修改日志

#### Scenario: 封禁学生账户（退学）
- **WHEN** 管理员点击"封禁账户"并提供原因
- **THEN** 系统将账户状态设置为"已封禁"，禁用登录和邮箱功能

#### Scenario: 解封学生账户
- **WHEN** 管理员点击"解封账户"
- **THEN** 系统将账户状态恢复为"活跃"，重新启用登录和邮箱功能

### Requirement: 注册审批管理
系统必须允许管理员查看、批准和拒绝学生注册申请。

#### Scenario: 查看待审批申请列表
- **WHEN** 管理员访问注册审批页面
- **THEN** 系统显示所有待审批的注册申请，按提交时间排序

#### Scenario: 查看申请详细信息
- **WHEN** 管理员点击某个申请
- **THEN** 系统显示申请的完整信息（注册码、邮箱、选择的专业/班级/国家等）

#### Scenario: 批准注册申请
- **WHEN** 管理员点击"批准"
- **THEN** 系统触发身份信息生成流程，创建学生账户

#### Scenario: 拒绝注册申请
- **WHEN** 管理员点击"拒绝"并输入拒绝原因
- **THEN** 系统标记申请为"已拒绝"，发送拒绝通知邮件

#### Scenario: 批量批准申请
- **WHEN** 管理员选择多个申请并点击"批量批准"
- **THEN** 系统批量触发身份信息生成流程

### Requirement: 邮件监控和管理
系统必须允许管理员查看所有学生的邮件收发记录，并管理邮件发送限制。

#### Scenario: 查看所有邮件记录
- **WHEN** 管理员访问邮件监控页面
- **THEN** 系统显示所有学生的邮件收发记录，包括发件人、收件人、主题、时间等

#### Scenario: 查看某个学生的邮件记录
- **WHEN** 管理员选择某个学生
- **THEN** 系统显示该学生的所有邮件记录

#### Scenario: 查看邮件内容
- **WHEN** 管理员点击某封邮件
- **THEN** 系统显示邮件的完整内容（主题、正文、附件）

#### Scenario: 调整学生邮件发送限制
- **WHEN** 管理员修改某个学生的每日发送限制（如从 1 件改为 5 件）
- **THEN** 系统更新该学生的邮件配额

#### Scenario: 全局调整邮件发送限制
- **WHEN** 超级管理员修改默认每日发送限制
- **THEN** 系统更新所有新注册学生的默认配额

### Requirement: 注册码生成和管理
系统必须允许管理��生成、查看和撤销注册码。

#### Scenario: 生成单个注册码
- **WHEN** 管理员点击"生成注册码"
- **THEN** 系统生成一个唯一的注册码，默认有效期由管理员配置

#### Scenario: 批量生成注册码
- **WHEN** 管理员输入数量（如 100）并点击"批量生成"
- **THEN** 系统生成 100 个唯一的注册码

#### Scenario: 设置注册码有效期
- **WHEN** 管理员生成注册码时设置有效期（如 30 天）
- **THEN** 系统记录有效期，注册码在 30 天后自动失效

#### Scenario: 查看注册码列表
- **WHEN** 管理员访问注册码管理页面
- **THEN** 系统显示所有注册码，包括状态（未使用/已使用/已过期/已撤销）

#### Scenario: 撤销注册码
- **WHEN** 管理员选择某个注册码并点击"撤销"
- **THEN** 系统将注册码状态设置为"已撤销"，无法再使用

#### Scenario: 导出注册码
- **WHEN** 管理员点击"导出注册码"
- **THEN** 系统生成包含所有未使用注册码的 CSV 文件

### Requirement: 数据可视化
系统必须提供数据可视化功能，展示学生账户、邮件、注册等统计信息。

#### Scenario: 显示学生账户统计
- **WHEN** 管理员访问仪表盘
- **THEN** 系统显示学生总数、活跃账户数、封禁账户数等统计信息

#### Scenario: 显示邮件收发统计
- **WHEN** 管理员访问邮件统计页面
- **THEN** 系统显示每日邮件发送量、接收量的折线图

#### Scenario: 显示注册申请统计
- **WHEN** 管理员访问注册统计页面
- **THEN** 系统显示待审批、已批准、已拒绝申请的数量和趋势

#### Scenario: 显示学生邮件使用情况
- **WHEN** 管理员查看某个学生的邮件统计
- **THEN** 系统显示该学生的邮件发送量、接收量、配额使用率等

### Requirement: 系统配置管理
系统必须允许超级管理员配置系统参数，如默认邮件配额、注册码有效期等。

#### Scenario: 配置默认邮件配额
- **WHEN** 超级管理员修改默认每日邮件发送限制
- **THEN** 系统更新配置，新注册学生使用新的默认值

#### Scenario: 配置注册码默认有效期
- **WHEN** 超级管理员修改注册码默认有效期
- **THEN** 系统更新配置，新生成的注册码使用新的默认值

#### Scenario: 配置 JWT 过期时间
- **WHEN** 超级管理员修改 JWT Token 默认过期时间
- **THEN** 系统更新配置，新登录的用户使用新的过期时间

#### Scenario: 配置密码复杂度要求
- **WHEN** 超级管理员修改密码最小长度或复杂度要求
- **THEN** 系统更新配置，新注册或修改密码时应用新规则

### Requirement: 审计日志查询
系统必须允许管理员查询审计日志，追踪所有管理员操作。

#### Scenario: 查看所有审计日志
- **WHEN** 管理员访问审计日志页面
- **THEN** 系统显示所有管理员操作记录，按时间倒序排列

#### Scenario: 筛选审计日志
- **WHEN** 管理员选择时间范围、操作类型或操作人
- **THEN** 系统显示匹配的审计日志

#### Scenario: 查看审计日志详情
- **WHEN** 管理员点击某条审计日志
- **THEN** 系统显示操作的完整信息（操作人、操作时间、操作内容、操作结果、IP 地址等）

#### Scenario: 导出审计日志
- **WHEN** 管理员点击"导出审计日志"
- **THEN** 系统生成包含所有审计日志的 CSV 文件

### Requirement: 管理员登录安全
系统必须实现管理员登录的安全机制，包括密码复杂度、登录失败锁定等。

#### Scenario: 管理员密码复杂度验证
- **WHEN** 管理员设置或修改密码
- **THEN** 系统验证密码符合复杂度要求（最小 8 位，包含大小写字母和数字）

#### Scenario: 管理员登录失败锁定
- **WHEN** 管理员连续 5 次登录失败
- **THEN** 系统锁定账户 30 分钟，显示错误消息"账户已锁定，请 30 分钟后再试"

#### Scenario: 管理员两步验证
- **WHEN** 管理员启用两步验证
- **THEN** 系统要求管理员在登录时输入 TOTP 验证码

#### Scenario: 管理员会话超时
- **WHEN** 管理员登录后 1 小时无操作
- **THEN** 系统自动登出，要求重新登录
